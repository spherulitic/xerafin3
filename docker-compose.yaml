services:
  keycloak:
    image: jboss/keycloak:latest
    volumes:
      - /var/opt/keycloak:/opt/jboss/keycloak/standalone/data
    environment:
#      KEYCLOAK_USER: "admin"
#      KEYCLOAK_PASSWORD: "admin"
      PROXY_ADDRESS_FORWARDING: "true"
#      KEYCLOAK_LOGLEVEL: "DEBUG"
  frontend:
    image: x-frontend:latest
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - keycloak
      - stats
      - cardbox
      - login
      - quiz
  stats:
    image: x-stats:latest
    volumes:
      - cardbox-data:/app/cardbox-data
  cardbox:
    image: x-cardbox:latest
    volumes:
      - cardbox-data:/app/cardbox-data
    depends_on:
      - keycloak
  quiz:
    image: x-quiz:latest
    environment:
      - MYSQL_USER
      - MYSQL_DB
      - MYSQL_PWD
      - MYSQL_HOST
    depends_on:
      - keycloak
    volumes:
      - quizjson:/app/quizjson
  login:
    image: x-login:latest
    volumes:
      - cardbox-data:/app/cardbox-data
  lexicon:
    image: x-lexicon:latest
    environment:
      - MYSQL_USER
      - MYSQL_DB
      - MYSQL_PWD
      - MYSQL_HOST
    depends_on:
      - keycloak
  lexicon-db:
    image: lexicon-db:latest
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin
      MONGO_INITDB_DATABASE: lexicon
volumes:
  cardbox-data:
    external: true
  quizjson:
